services:
  app:
    image: ghcr.io/flying-japan/int-center-luggage-prd:latest
    container_name: flying-japan-app
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./uploads:/app/uploads

  tunnel:
    image: cloudflare/cloudflared:2026.2.0
    container_name: flying-japan-tunnel
    restart: unless-stopped
    command: tunnel --no-autoupdate run --token ${TUNNEL_TOKEN}
    depends_on:
      - app

  # Auto-updates app when a new image is pushed to GHCR.
  # Polls every 30 seconds. Requires GHCR_USER + GHCR_TOKEN in .env.
  # Create token at: https://github.com/settings/tokens (read:packages scope)
  watchtower:
    image: containrrr/watchtower
    container_name: flying-japan-watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      REPO_USER: ${GHCR_USER}
      REPO_PASS: ${GHCR_TOKEN}
      WATCHTOWER_POLL_INTERVAL: "30"
      WATCHTOWER_CLEANUP: "true"
